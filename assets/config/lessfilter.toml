# ==============================
#   Rule Matching
# ==============================


# In event of a tie, last one wins.

# ----------
#   Syntax
# ----------
# Add: +{value}|{rule},
# Sub: -{value}|{rule},
# Max: >{value}|{rule},
# Max: {value}|{rule},
# Min: <{value}|{rule},
# Req: ^|{rule},
# Default Score: {rule},

# ------------------
#   Default scores
# ------------------
# glob: Max(100),
# child: Max(50),
# cat: Max(20),
# mime: Max(20),
# ext: Max(10)


# ------------------------------------------------------------ #

[rules]
  default = [
    [ [ "Metadata" ], [ "1|*/*" ] ],
    [ [ "Image" ], [ "1|image/*" ] ],
    [ [ "Text" ], [ "1|type:text" ] ],
    [ [ "Extract", "Metadata" ], [ "1|cat:document", "1|cat:spreadsheet", "1|cat:email", "1|cat:academic" ] ], # try extracting, with fallback to metadata
    [ [ "Directory" ], [ "1|directory/*" ] ],
  ]
  preview = [
    [ [ "sqlite" ], [ "application/vnd.sqlite3", "have:sqlite3" ] ],
  ]

  # the 'n' alias, and the `Advance` action in the ui
  edit = [
    [ [ "Open" ], [ "1|cat:document", "1|cat:spreadsheet", "1|cat:email", "1|cat:academic" ] ],
  ]

  # the 'l' alias
  display = [
    [
      [ "Metadata" ],
      [
        "1|cat:compressed",
      ],
    ],
  ]

  # the 'la' alias
  extended = [  ]

  # the 'll' alias
  info = [  ]

  # opener
  open = [  ] #  Metadata, Image, Text, Extract all defer to fs: open in this preset and the next

  alternate = [
    [ [ "none" ], [ "*/*" ] ],
  ]

[actions]
  sqlite = '''
sqlite3 {} "SELECT name FROM sqlite_master WHERE type='table' ORDER BY name;" |
while read -r tbl; do
    [[ -n $tbl ]] || continue;
    echo "== $tbl ($(sqlite3 {} "SELECT COUNT(*) FROM \"$tbl\";")) rows =="
    sqlite3 {} <<EOF
.headers on
.mode column
SELECT * FROM "$tbl" LIMIT 5;
EOF
    echo
done
'''
