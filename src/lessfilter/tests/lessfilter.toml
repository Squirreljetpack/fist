infer=true

[rules]
  default=[

  ]
  preview=[
    [["Directory"], ["40|mime:directory/*"]],
    [["Image"], ["mime:image/*"]],
    [["Text"], ["mime:text/*"]],
    [["Metadata"], ["5|mime:*/*"]],
    [["sqlite"], ["mime:application/vnd.sqlite3"]],
    [
      ["Metadata"],
      [
        "mime:application/zip",
        "mime:application/x-tar",
        "mime:application/x-gzip",
        "mime:application/x-bzip2",
        "mime:application/x-xz",
        "ext:zip",
        "ext:tar",
        "ext:gz",
        "ext:bz2",
        "ext:xz",
      ],
    ],
  ]

  edit=[
    [["Text"], ["mime:text/*"]],
    [["Directory"], ["mime:directory/*"]],
    [
      ["Metadata"],
      [
        "mime:application/zip",
        "mime:application/x-tar",
        "mime:application/x-gzip",
        "mime:application/x-bzip2",
        "mime:application/x-xz",
        "ext:zip",
        "ext:tar",
        "ext:gz",
        "ext:bz2",
        "ext:xz",
      ],
    ],
  ]

  display=[
    [["Directory"], ["mime:directory/*"]],
    [["Text"], ["mime:text/*"]],
    [["Metadata"], []],
  ]

  extended=[
    [["Image"], ["mime:image/*"]],
    [["Directory"], ["mime:directory/*"]],
    [["Text"], ["mime:text/*"]],
    [["Metadata"], []],
  ]

  info=[
    [["Image"], ["mime:image/*"]],
    [["Directory"], ["mime:directory/*"]],
    [["Metadata"], []],
  ]

  open=[
    [["Directory"], ["mime:directory/*"]],
    [["Text"], ["mime:text/*"]],
    [["Image"], ["mime:image/*"]],
    [["Metadata"], []],
  ]

[actions]
  sqlite='''
have() {
    command -v "$1" >/dev/null 2>&1
}

if have sqlite3; then
    sqlite3 {} "SELECT name FROM sqlite_master WHERE type='table' ORDER BY name;" |
    while read -r tbl; do
        [[ -n $tbl ]] || continue;
        echo "== $tbl ($(sqlite3 {} "SELECT COUNT(*) FROM \"$tbl\";")) rows =="
        sqlite3 {} <<EOF
.headers on
.mode column
SELECT * FROM "$tbl" LIMIT 5;
EOF
    echo
    done
elif have file; then
    file -bL {}
else
    echo "No viewer for {}"
fi
'''
